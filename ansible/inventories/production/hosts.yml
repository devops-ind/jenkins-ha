---
# Production Multi-VM Inventory - Option 2: Hybrid Architecture
# Architecture: Jenkins Blue VM + Jenkins Green VM + Shared Services VM
# Cost-effective multi-VM setup with Jenkins isolation and shared infrastructure

all:
  vars:
    # Environment identification
    deployment_environment: "production"
    environment_tier: "prod"
    deployment_mode: "production"

    # Multi-VM Architecture Configuration
    multi_vm_enabled: true
    multi_vm_architecture: "option2-hybrid"  # Hybrid: Separate Jenkins VMs + Shared Services

    # Ansible connection settings
    ansible_connection: ssh
    ansible_user: root  # Adjust if using different user
    ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'

    # CentOS 9 specific settings
    ansible_python_interpreter: /usr/bin/python3
    package_manager: dnf
    os_family: "RedHat"

    # SSL Configuration (enabled for production HTTPS)
    ssl_enabled: false

    # Production-grade settings
    monitoring_enabled: true
    backup_enabled: true
    jenkins_ha_enabled: true

    # Container runtime
    jenkins_container_runtime: "docker"
    haproxy_container_runtime: "docker"

    # GlusterFS Configuration (replicated storage between Jenkins VMs)
    shared_storage_enabled: true
    shared_storage_type: "glusterfs"  # Changed from 'local' to 'glusterfs' for multi-VM
    glusterfs_replicas: 2  # Replicate between jenkins-blue and jenkins-green VMs
    glusterfs_volume_type: "replicate"

    # Domain configuration for VM deployment
    jenkins_domain: "dev.net"
    jenkins_wildcard_domain: "*.dev.net"

    # HAProxy Virtual IP (for future HA setup)
    haproxy_vip: "192.168.188.150"
    haproxy_vip_enabled: false  # Disabled initially, can enable with Keepalived later

# ==============================================================================
# JENKINS VMS - Blue/Green Architecture
# ==============================================================================

# Jenkins Masters - Distributed across Blue and Green VMs
jenkins_masters:
  hosts:
    jenkins-blue:
      ansible_host: 192.168.188.142
      ansible_port: 22
      jenkins_master_priority: 1
      jenkins_vm_role: "blue"  # Blue environment
      host_fqdn: jenkins-blue.dev.net
      monitoring_fqdn: monitoring.dev.net
      # Team distribution - which teams run on this VM
      jenkins_teams_on_vm:
        - devops
        - ma

    jenkins-green:
      ansible_host: 192.168.188.143
      ansible_port: 22
      jenkins_master_priority: 2
      jenkins_vm_role: "green"  # Green environment
      host_fqdn: jenkins-green.dev.net
      monitoring_fqdn: monitoring.dev.net
      # Team distribution - which teams run on this VM
      jenkins_teams_on_vm:
        - ba
        - tw

# ==============================================================================
# SHARED SERVICES VM - HAProxy, Monitoring, Storage Coordination
# ==============================================================================

# Load Balancers - Dedicated VM with cross-VM routing
load_balancers:
  hosts:
    shared-services:
      ansible_host: 192.168.188.144
      host_fqdn: shared-services.dev.net
      monitoring_fqdn: monitoring.dev.net
      haproxy_backend_mode: "cross-vm"  # Routes to Jenkins VMs across network
      # HAProxy backends include both jenkins-blue and jenkins-green VMs
      haproxy_cross_vm_backends:
        - host: jenkins-blue
          ip: 192.168.188.142
        - host: jenkins-green
          ip: 192.168.188.143

# Monitoring - Centralized monitoring for all VMs
monitoring:
  hosts:
    shared-services:
      ansible_host: 192.168.188.144
      host_fqdn: monitoring.dev.net
      monitoring_fqdn: monitoring.dev.net
      # Monitor all Jenkins VMs
      monitoring_targets:
        - host: jenkins-blue
          ip: 192.168.188.142
          role: jenkins-vm
        - host: jenkins-green
          ip: 192.168.188.143
          role: jenkins-vm

# Shared Storage - GlusterFS coordination (actual storage on Jenkins VMs)
shared_storage:
  hosts:
    shared-services:
      ansible_host: 192.168.188.144
      host_fqdn: shared-services.dev.net
      storage_role: "coordinator"  # Coordinates backup/recovery, doesn't host data

# ==============================================================================
# GLUSTERFS CLUSTER - Replicated storage between Jenkins VMs
# ==============================================================================

# GlusterFS Servers - Both Jenkins VMs participate in storage cluster
glusterfs_servers:
  hosts:
    jenkins-blue:
      ansible_host: 192.168.188.142
      host_fqdn: jenkins-blue.dev.net
      glusterfs_brick_dir: "/data/glusterfs/bricks"
      glusterfs_role: "primary"
      glusterfs_priority: 1

    jenkins-green:
      ansible_host: 192.168.188.143
      host_fqdn: jenkins-green.dev.net
      glusterfs_brick_dir: "/data/glusterfs/bricks"
      glusterfs_role: "replica"
      glusterfs_priority: 2

# ==============================================================================
# ARCHITECTURE DOCUMENTATION
# ==============================================================================

# Option 2: Hybrid Architecture
#
# VM Layout:
# ┌────────────────────┐  ┌────────────────────┐  ┌────────────────────┐
# │  jenkins-blue      │  │  jenkins-green     │  │  shared-services   │
# │  192.168.188.142   │  │  192.168.188.143   │  │  192.168.188.144   │
# ├────────────────────┤  ├────────────────────┤  ├────────────────────┤
# │ Jenkins (devops)   │  │ Jenkins (ba)       │  │ HAProxy            │
# │ Jenkins (ma)       │  │ Jenkins (tw)       │  │ Prometheus         │
# │                    │  │                    │  │ Grafana            │
# │ GlusterFS Server   │  │ GlusterFS Server   │  │ Loki               │
# │ (brick storage)    │  │ (brick storage)    │  │ Alertmanager       │
# └────────────────────┘  └────────────────────┘  └────────────────────┘
#          │                       │                        │
#          └───────────────────────┴────────────────────────┘
#                   GlusterFS Replicated Volumes
#
# Benefits:
# - Jenkins isolation (blue/green VMs)
# - Shared monitoring/HAProxy (cost efficient)
# - GlusterFS replication between Jenkins VMs
# - Team distribution for load balancing
# - Gradual migration friendly
#
# Team Distribution Strategy:
# - Blue VM: devops (8 CPU), ma (4 CPU) = 12 CPU total
# - Green VM: ba (4 CPU), tw (4 CPU) = 8 CPU total
# - Balanced workload distribution
#
# Migration Path:
# Phase 1: Deploy monitoring to VM3 (144)
# Phase 2: Setup GlusterFS between VM1 (142) and VM2 (143)
# Phase 3: Deploy HAProxy to VM3 (144) with cross-VM backends
# Phase 4: Migrate teams to distributed VMs
