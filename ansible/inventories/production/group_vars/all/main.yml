---
# Production CentOS 9 VM Configuration
# Real production settings for Jenkins HA on CentOS 9

# Environment identification
deployment_environment: "production"
environment_tier: "prod"
deployment_mode: "production"

# CentOS 9 specific configurations
os_family: "RedHat"
package_manager: "dnf"
firewall_service: "firewalld"

# Jenkins configuration for production
jenkins_admin_user: "admin"
jenkins_admin_password: "{{ vault_jenkins_admin_password | default('admin123') }}"
jenkins_version: "lts"

# HAProxy configuration for production VM
haproxy_image_registry: "docker.io"
haproxy_image_name: "haproxy"
haproxy_image_tag: "2.8"  # Use stable Debian-based image
haproxy_stats_user: "admin"
haproxy_stats_password: "{{ vault_haproxy_stats_password | default('admin123') }}"

# Monitoring configuration with domain routing (corrected domains)
monitoring_enabled: true
prometheus_retention: "15d"  # Production retention
prometheus_port: 9090
prometheus_domain: "prometheus.{{ monitoring_domain }}"  # prometheus.devops.example.com
grafana_admin_user: "admin"
grafana_admin_password: "{{ vault_grafana_admin_password | default('admin123') }}"
grafana_port: 9300  # Production port
grafana_domain: "grafana.{{ monitoring_domain }}"  # grafana.devops.example.com
node_exporter_port: 9100
node_exporter_domain: "node-exporter.{{ monitoring_domain }}"  # node-exporter.devops.example.com

# Backup configuration
backup_enabled: true
backup_retention_days: 30
backup_schedule_hour: 2
backup_schedule_minute: 0

# Docker configuration for CentOS 9
docker_edition: "ce"
docker_enable_audit: true  # Production security
docker_daemon_config:
  log-driver: "json-file"
  log-opts:
    max-size: "10m"
    max-file: "3"
  storage-driver: "overlay2"
  exec-opts:
    - "native.cgroupdriver=systemd"

# Security settings for production
security_hardening_enabled: true
selinux_enabled: true
selinux_policy: "targeted"
selinux_mode: "enforcing"

# Resource limits for production VM
jenkins_master_memory_limit: "2g"
jenkins_master_cpu_limit: "1.5"
haproxy_memory_limit: "512M"
haproxy_cpu_limit: "0.5"

# Network settings
jenkins_network_name: "jenkins-network"
monitoring_network_name: "monitoring-net"

# Shared storage settings
shared_storage_enabled: true
shared_storage_type: "local"  # Options: local, nfs, glusterfs
shared_storage_path: "/opt/jenkins-shared"
shared_storage_owner: "jenkins"
shared_storage_group: "jenkins"

# GlusterFS backup servers (for client failover when using GlusterFS)
glusterfs_backup_servers: ""  # Will be auto-populated in multi-node setup

# Production-specific user/group mappings to avoid conflicts
jenkins_uid: 1001
jenkins_gid: 1001
monitoring_uid: 1005
monitoring_gid: 1005
haproxy_uid: 1004

# HAProxy should bind to port 8090 (HTTP), avoiding privileged port 80 in host networking
jenkins_port: 8090
haproxy_gid: 1004

# Domain configuration for production (corrected structure)
jenkins_domain: "devops.example.com"
jenkins_wildcard_domain: "*.devops.example.com"
monitoring_domain: "devops.example.com"  # Monitoring services use same base domain
monitoring_wildcard_domain: "*.devops.example.com"

# Multi-team configuration for production HAProxy load balancing
# devops is the default team (handles jenkins.devops.example.com as default)
# Team subdomain format: {team}jenkins.devops.example.com
jenkins_teams_config:
  - team_name: "devops"
    blue_green_enabled: true
    active_environment: "green"
    ports:
      web: 8080
      agent: 50000
    resources:
      memory: "2g"
      cpu: "1.0"
    env_vars: {}
    labels:
      tier: "production"
      environment: "prod"
      role: "default"
    # Jenkins DSL repositories for external job definitions
    jenkins_dsl_repos:
      - repo_url: "https://github.com/devops-team/jenkins-dsl.git"
        repo_branch: "main"
        dsl_directory: "dsl"
        credentials_id: "devops-git-credentials"
        scan_schedule: "H/30 * * * *"  # Scan every 30 minutes
        description: "DevOps team job definitions and pipelines"
      - repo_url: "https://github.com/shared/common-dsl.git"
        repo_branch: "main"
        dsl_directory: "common"
        credentials_id: "shared-git-credentials"
        scan_schedule: "H H/4 * * *"  # Scan every 4 hours
        description: "Shared common DSL templates and utilities"
  - team_name: "ma"
    blue_green_enabled: true
    active_environment: "blue"
    ports:
      web: 8081
      agent: 50001
    resources:
      memory: "2g"
      cpu: "1.0"
    env_vars: {}
    labels:
      tier: "production"
      environment: "prod"
      role: "marketing-analytics"
    # Jenkins DSL repositories for marketing analytics team
    jenkins_dsl_repos:
      - repo_url: "https://github.com/ma-team/jenkins-dsl.git"
        repo_branch: "main"
        dsl_directory: "dsl"
        credentials_id: "ma-git-credentials"
        scan_schedule: "H/45 * * * *"  # Scan every 45 minutes (offset from devops)
        description: "Marketing Analytics team job definitions"
  - team_name: "ba"
    blue_green_enabled: true
    active_environment: "blue"
    ports:
      web: 8082
      agent: 50002
    resources:
      memory: "2g"
      cpu: "1.0"
    env_vars: {}
    labels:
      tier: "production"
      environment: "prod"
      role: "business-analytics"
    # Jenkins DSL repositories for business analytics team
    jenkins_dsl_repos:
      - repo_url: "https://github.com/ba-team/jenkins-dsl.git"
        repo_branch: "main"
        dsl_directory: "dsl"
        credentials_id: "ba-git-credentials"
        scan_schedule: "H/15 * * * *"  # Scan every 15 minutes (offset from others)
        description: "Business Analytics team job definitions"
  - team_name: "tw"
    blue_green_enabled: true
    active_environment: "blue"
    ports:
      web: 8083
      agent: 50003
    resources:
      memory: "2g"
      cpu: "1.0"
    env_vars: {}
    labels:
      tier: "production"
      environment: "prod"
      role: "test-qa"
    # Jenkins DSL repositories for test/QA team
    jenkins_dsl_repos:
      - repo_url: "https://github.com/tw-team/jenkins-dsl.git"
        repo_branch: "main"
        dsl_directory: "dsl"
        credentials_id: "tw-git-credentials"
        scan_schedule: "H/20 * * * *"  # Scan every 20 minutes (offset from others)
        description: "Test/QA team job definitions and test automation"

# Timezone
common_timezone: "UTC"

# Performance tuning for production
vm_swappiness: 10
vm_max_map_count: 262144

# Firewall ports to open
firewall_allowed_ports:
  - "8080/tcp"  # DevOps Jenkins
  - "8081/tcp"  # Developer Jenkins  
  - "8090/tcp"  # HAProxy HTTP
  - "443/tcp"   # HAProxy HTTPS (future)
  - "8404/tcp"  # HAProxy Stats
  - "9090/tcp"  # Prometheus
  - "9100/tcp"  # Node Exporter
  - "9200/tcp"  # cAdvisor
  - "9300/tcp"  # Grafana (changed from 3000)
  - "22/tcp"    # SSH