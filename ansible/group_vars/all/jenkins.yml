---
# Jenkins Default Configuration
# These are default values that can be overridden in environment-specific group_vars

# Default Jenkins version (can be overridden per environment)
jenkins_version: "2.516.2-lts-jdk21"
jenkins_dynamic_agent_version: "{{ jenkins_version }}"

# Default ports
jenkins_master_port: 8080
jenkins_jnlp_port: 50000  # Used for dynamic agent connections

# Default paths - should be overridden in environment-specific configs
jenkins_home_dir: "/var/jenkins"
jenkins_user: "jenkins"
jenkins_group: "jenkins"
jenkins_uid: 1002
jenkins_gid: 1002

# Default Jenkins configuration
images_to_build: "master"
build_jenkins_images: true
jenkins_images_push: false
jenkins_admin_user: "admin"
jenkins_enable_security: true
jenkins_enable_csrf: true
jenkins_enable_agent_protocols: "JNLP4-connect"  # Protocol for dynamic agents

# Default plugins - can be extended in environment configs
jenkins_plugins:
  - workflow-aggregator
  - docker-workflow
  - kubernetes
  - prometheus
  - configuration-as-code
  - build-timeout
  - credentials-binding
  - timestamper
  - ws-cleanup
  - ant
  - gradle

# Default container configuration
jenkins_container_runtime: "docker"  # Global container runtime for all roles
jenkins_master_memory: "2g"
jenkins_master_java_opts: "-Djenkins.install.runSetupWizard=false"

# Default network settings
jenkins_network_name: "jenkins-net"
jenkins_network_subnet: "172.20.0.0/16"

# Default backup settings
jenkins_backup_enabled: false
jenkins_backup_schedule: "0 2 * * 0"
jenkins_backup_retention_days: 30

# Default monitoring settings
jenkins_monitoring_enabled: true
jenkins_metrics_enabled: true

# Default security settings
jenkins_security_realm: "local"
jenkins_authorization_strategy: "logged_in_users_can_do_anything"

# Blue-Green Deployment Configuration
# Controls single-master deployment with blue-green switching capability
jenkins_deployment_mode: "blue-green"  # Options: "ha" (dual-master) or "blue-green" (single-master)
jenkins_blue_green_enabled: true
jenkins_current_environment: "blue"  # Current active environment: "blue" or "green"
jenkins_target_environment: "green"   # Target environment for next deployment
jenkins_blue_green_port_offset: 10     # Port offset between blue and green (blue: 8080, green: 8090)
jenkins_blue_green_shared_data: true    # Share Jenkins data between environments
jenkins_blue_green_health_check_retries: 10
jenkins_blue_green_health_check_delay: 15
jenkins_blue_green_switch_timeout: 300  # Timeout for environment switching in seconds

# Blue-Green Environment Specific Configuration
jenkins_blue_container_name: "jenkins-blue"
jenkins_green_container_name: "jenkins-green"
jenkins_blue_port: "{{ jenkins_master_port }}"
jenkins_green_port: "{{ jenkins_master_port + jenkins_blue_green_port_offset }}"
jenkins_blue_agent_port: "{{ jenkins_jnlp_port }}"
jenkins_green_agent_port: "{{ jenkins_jnlp_port + jenkins_blue_green_port_offset }}"

# Blue-Green Volume Configuration
jenkins_shared_home_volume: "jenkins-shared-home"  # Shared between blue and green
jenkins_blue_temp_volume: "jenkins-blue-temp"      # Blue-specific temporary data
jenkins_green_temp_volume: "jenkins-green-temp"    # Green-specific temporary data
jenkins_shared_plugins_volume: "jenkins-shared-plugins"  # Shared plugin directory

# Blue-Green Load Balancer Integration
jenkins_load_balancer_backend_file: "/etc/haproxy/conf.d/jenkins-backend.cfg"
jenkins_active_backend_port: "{{ jenkins_blue_port if jenkins_current_environment == 'blue' else jenkins_green_port }}"
jenkins_standby_backend_port: "{{ jenkins_green_port if jenkins_current_environment == 'blue' else jenkins_blue_port }}"

# Blue-Green Health Check Configuration
jenkins_health_check_endpoint: "/api/json?pretty=true"
jenkins_health_check_expected_status: 200
jenkins_health_check_timeout: 10

# Blue-Green Deployment Strategy Settings
jenkins_pre_deployment_backup: true     # Create backup before switching environments
jenkins_post_deployment_verification: true  # Run verification tests after switching
jenkins_auto_rollback_enabled: true     # Automatically rollback on health check failure
jenkins_rollback_timeout: 120           # Time to wait before automatic rollback

# Blue-Green Network Configuration
jenkins_blue_network_alias: "jenkins-blue"
jenkins_green_network_alias: "jenkins-green"
jenkins_active_network_alias: "jenkins-active"  # DNS alias pointing to active environment

# Image Building Configuration
jenkins_images_build_dir: "/tmp/jenkins-images-build"  # Used by jenkins-images role
jenkins_images_force_rebuild: false
# jenkins_images_push: false
jenkins_images_cleanup: true

# Jenkins Version Configuration
jenkins_master_image_tag: "{{ jenkins_version }}"
jenkins_agent_image_tag: "{{ jenkins_dynamic_agent_version }}"

# JCasC Hot-Reload Configuration
# Settings for zero-downtime configuration updates via file-based hot-reload
jenkins_base_path: "/var/jenkins"
jenkins_reload_timeout: 60                        # Timeout for hot-reload API call in seconds
jenkins_reload_health_retries: 5                  # Number of retries for post-reload health check
jenkins_reload_health_delay: 5                    # Delay between health check retries in seconds
jenkins_audit_log: "/var/log/jenkins/jcasc-updates.log"  # Audit log path for config updates
