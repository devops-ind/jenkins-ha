# Podman containers.conf configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

[containers]
# Logging driver for containers
log_driver = "{{ podman_daemon_options.log_driver }}"

# Container runtime to use
runtime = "{{ podman_daemon_options.runtime }}"

# Conmon binary path
conmon_path = "{{ podman_daemon_options.conmon_path }}"

# Network backend (netavark or cni)
network_backend = "{{ podman_daemon_options.network_backend }}"

# Event logger (journald, file, or none)
events_logger = "{{ podman_daemon_options.events_logger }}"

# Cgroup manager (systemd or cgroupfs)
cgroup_manager = "{{ podman_daemon_options.cgroup_manager }}"

# Security profiles
{% if podman_daemon_options.seccomp_profile is defined %}
seccomp_profile = "{{ podman_daemon_options.seccomp_profile }}"
{% endif %}

{% if podman_daemon_options.apparmor_profile is defined %}
apparmor_profile = "{{ podman_daemon_options.apparmor_profile }}"
{% endif %}

# Default resource limits
{% if podman_default_limits.memory is defined %}
default_memory = "{{ podman_default_limits.memory }}"
{% endif %}

{% if podman_default_limits.cpu_quota is defined %}
default_cpu_quota = "{{ podman_default_limits.cpu_quota }}"
{% endif %}

{% if podman_default_limits.pids_limit is defined %}
default_pids_limit = {{ podman_default_limits.pids_limit }}
{% endif %}

# Image pull policy
default_pull_policy = "{{ podman_image_pull_policy }}"

# Health check settings
{% if podman_health_check_enabled %}
health_check_interval = "{{ podman_health_check_interval }}"
health_check_timeout = "{{ podman_health_check_timeout }}"
health_check_retries = {{ podman_health_check_retries }}
{% endif %}

# Enable Podman secrets management
{% if podman_enable_secrets %}
enable_secrets = true
{% endif %}

# Enable Kubernetes YAML support
{% if podman_enable_kube_play %}
enable_kube_play = true
{% endif %}

# Rootless container settings
{% if podman_enable_rootless %}
# Additional configuration for rootless containers
rootless = true

# User namespace settings
userns = "auto"
{% endif %}

# Logging configuration
[logging]
driver = "{{ podman_daemon_options.log_driver }}"

{% if podman_daemon_options.log_opts is defined %}
[logging.options]
{% for key, value in podman_daemon_options.log_opts.items() %}
{{ key }} = "{{ value }}"
{% endfor %}
{% endif %}

# Network configuration
[network]
# Default network name
default_network = "{{ podman_default_pod_network | default('podman') }}"

# Network backend
network_backend = "{{ podman_daemon_options.network_backend }}"

{% if podman_network_backend == "cni" and podman_cni_plugins is defined %}
# CNI plugins
cni_plugin_dirs = [
    "/usr/libexec/cni",
    "/usr/lib/cni",
    "/usr/local/lib/cni",
    "/opt/cni/bin"
]
{% endif %}

# Engine configuration
[engine]
# Container engines to search for
container_engines = ["podman", "cri-o"]

# Image signature policy
{% if podman_image_signature_policy is defined %}
signature_policy = "{{ podman_image_signature_policy }}"
{% endif %}

# Stop timeout for containers
stop_timeout = 10

# Number of seconds to wait for container exit
exit_command_delay = 5

# Machine configuration (for macOS/Windows)
{% if ansible_os_family == "Darwin" and podman_machine_enabled %}
[machine]
memory = {{ podman_machine_memory }}
cpus = {{ podman_machine_cpus }}
disk_size = {{ podman_machine_disk_size }}
{% endif %}

# Service configuration
[service]
{% if podman_api_enabled %}
# Enable REST API
enable_api = true
api_port = {{ podman_api_port }}

{% if podman_api_cors_headers is defined %}
cors_headers = "{{ podman_api_cors_headers }}"
{% endif %}
{% endif %}

# Metrics configuration
{% if podman_metrics_enabled %}
enable_metrics = true
metrics_port = {{ podman_metrics_port }}
{% endif %}

# Build configuration
[build]
{% if podman_build_enabled %}
# Build isolation level
isolation = "{{ podman_build_isolation }}"

# Enable Buildah for advanced builds
{% if podman_buildah_enabled %}
buildah_enabled = true
{% endif %}
{% endif %}

# Security configuration
[security]
{% if podman_enable_selinux %}
selinux = true
{% endif %}

{% if podman_enable_apparmor %}
apparmor = true
{% endif %}

# Compatibility configuration
[compat]
{% if podman_docker_compatibility %}
# Enable Docker API compatibility
docker_api = true
{% endif %}

{% if podman_kubernetes_compatible %}
# Enable Kubernetes compatibility
kubernetes = true
{% endif %}

# Volume configuration
[volumes]
# Default volume driver
driver = "local"