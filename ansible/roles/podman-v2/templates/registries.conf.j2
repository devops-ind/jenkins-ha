# Podman registries.conf configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

# Unqualified image search registries (in order of preference)
unqualified-search-registries = [
{% for registry in podman_unqualified_search_registries %}
    "{{ registry }}"{% if not loop.last %},{% endif %}
{% endfor %}
]

# Short name aliasing
short-name-mode = "enforcing"

{% if podman_registry_mirrors | length > 0 %}
# Registry mirrors
{% for mirror in podman_registry_mirrors %}
[[registry]]
prefix = "{{ mirror.prefix | default('docker.io') }}"
location = "{{ mirror.location }}"

{% if mirror.insecure is defined and mirror.insecure %}
[[registry.mirror]]
location = "{{ mirror.location }}"
insecure = true
{% endif %}
{% endfor %}
{% endif %}

{% if podman_insecure_registries | length > 0 %}
# Insecure registries (HTTP instead of HTTPS)
{% for registry in podman_insecure_registries %}
[[registry]]
location = "{{ registry }}"
insecure = true
{% endfor %}
{% endif %}

{% if podman_blocked_registries | length > 0 %}
# Blocked registries
{% for registry in podman_blocked_registries %}
[[registry]]
location = "{{ registry }}"
blocked = true
{% endfor %}
{% endif %}

# Default registry configuration
[[registry]]
location = "{{ podman_default_registry }}"

{% if podman_registries_auth is defined and podman_registries_auth | length > 0 %}
# Registry authentication
{% for registry, auth in podman_registries_auth.items() %}
[[registry]]
location = "{{ registry }}"

{% if auth.username is defined and auth.password is defined %}
# Authentication via username/password
[registry.auth]
username = "{{ auth.username }}"
password = "{{ auth.password }}"
{% endif %}

{% if auth.auth_file is defined %}
# Authentication via auth file
auth_file_path = "{{ auth.auth_file }}"
{% endif %}

{% if auth.cert_dir is defined %}
# TLS certificate directory
cert_dir = "{{ auth.cert_dir }}"
{% endif %}

{% if auth.tls_verify is defined %}
# TLS verification
tls_verify = {{ auth.tls_verify | lower }}
{% endif %}
{% endfor %}
{% endif %}

# Registry-specific configurations
[[registry]]
location = "docker.io"
# Docker Hub specific settings

{% if podman_docker_hub_mirror is defined %}
[[registry.mirror]]
location = "{{ podman_docker_hub_mirror }}"
{% endif %}

[[registry]]
location = "quay.io"
# Quay.io specific settings

[[registry]]
location = "registry.redhat.io"
# Red Hat registry specific settings

[[registry]]
location = "registry.access.redhat.com"
# Red Hat public registry

[[registry]]
location = "registry.fedoraproject.org"
# Fedora registry

# Private registry configurations (if any)
{% if podman_private_registries is defined %}
{% for registry in podman_private_registries %}
[[registry]]
location = "{{ registry.location }}"

{% if registry.insecure is defined and registry.insecure %}
insecure = true
{% endif %}

{% if registry.blocked is defined and registry.blocked %}
blocked = true
{% endif %}

{% if registry.mirrors is defined %}
{% for mirror in registry.mirrors %}
[[registry.mirror]]
location = "{{ mirror.location }}"
{% if mirror.insecure is defined and mirror.insecure %}
insecure = true
{% endif %}
{% endfor %}
{% endif %}

{% if registry.auth is defined %}
[registry.auth]
{% if registry.auth.username is defined and registry.auth.password is defined %}
username = "{{ registry.auth.username }}"
password = "{{ registry.auth.password }}"
{% endif %}
{% if registry.auth.auth_file is defined %}
auth_file_path = "{{ registry.auth.auth_file }}"
{% endif %}
{% endif %}

{% if registry.tls is defined %}
{% if registry.tls.cert_dir is defined %}
cert_dir = "{{ registry.tls.cert_dir }}"
{% endif %}
{% if registry.tls.tls_verify is defined %}
tls_verify = {{ registry.tls.tls_verify | lower }}
{% endif %}
{% if registry.tls.ca_file is defined %}
ca_file = "{{ registry.tls.ca_file }}"
{% endif %}
{% endif %}
{% endfor %}
{% endif %}

# Development and testing registries
{% if deployment_mode | default('production') in ['local', 'development'] %}
[[registry]]
location = "localhost:5000"
insecure = true

[[registry]]
location = "127.0.0.1:5000"
insecure = true
{% endif %}