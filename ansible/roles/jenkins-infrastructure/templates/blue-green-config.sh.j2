#!/bin/bash
# Jenkins Blue-Green Deployment Configuration
# Source this file to load blue-green deployment settings
# Generated by Ansible

# Deployment Configuration
export JENKINS_DEPLOYMENT_MODE="blue-green"
export JENKINS_CONTAINER_RUNTIME="{{ jenkins_container_runtime }}"
export JENKINS_HOME="{{ jenkins_home_dir }}"

# Container Names
export JENKINS_BLUE_CONTAINER="{{ jenkins_blue_container_name }}"
export JENKINS_GREEN_CONTAINER="{{ jenkins_green_container_name }}"

# Port Configuration
export JENKINS_BLUE_PORT="{{ jenkins_blue_port }}"
export JENKINS_GREEN_PORT="{{ jenkins_green_port }}"
export JENKINS_BLUE_AGENT_PORT="{{ jenkins_blue_agent_port }}"
export JENKINS_GREEN_AGENT_PORT="{{ jenkins_green_agent_port }}"
export JENKINS_MASTER_PORT="{{ jenkins_master_port }}"

# Load Balancer Configuration
export JENKINS_VIP="{{ jenkins_vip | default(ansible_default_ipv4.address) }}"
export JENKINS_LB_BACKEND_FILE="{{ jenkins_load_balancer_backend_file }}"

# Health Check Configuration
export JENKINS_HEALTH_CHECK_RETRIES="{{ jenkins_blue_green_health_check_retries }}"
export JENKINS_HEALTH_CHECK_DELAY="{{ jenkins_blue_green_health_check_delay }}"
export JENKINS_HEALTH_CHECK_TIMEOUT="{{ jenkins_health_check_timeout }}"
export JENKINS_SWITCH_TIMEOUT="{{ jenkins_blue_green_switch_timeout }}"

# Shared Storage Configuration
export JENKINS_SHARED_STORAGE_PATH="{{ shared_storage_path | default('/shared/jenkins') }}"
export JENKINS_SHARED_HOME_VOLUME="{{ jenkins_shared_home_volume }}"
export JENKINS_SHARED_PLUGINS_VOLUME="{{ jenkins_shared_plugins_volume }}"

# Network Configuration
export JENKINS_NETWORK_NAME="{{ jenkins_network_name }}"
export JENKINS_BLUE_NETWORK_ALIAS="{{ jenkins_blue_network_alias }}"
export JENKINS_GREEN_NETWORK_ALIAS="{{ jenkins_green_network_alias }}"
export JENKINS_ACTIVE_NETWORK_ALIAS="{{ jenkins_active_network_alias }}"

# Automation Settings
export JENKINS_AUTO_ROLLBACK_ENABLED="{{ jenkins_auto_rollback_enabled | default(true) | lower }}"
export JENKINS_PRE_DEPLOYMENT_BACKUP="{{ jenkins_pre_deployment_backup | default(true) | lower }}"
export JENKINS_POST_DEPLOYMENT_VERIFICATION="{{ jenkins_post_deployment_verification | default(true) | lower }}"

# Context Path
export JENKINS_CONTEXT_PATH="{{ jenkins_context_path | default('') }}"

# Backup Configuration
export JENKINS_BACKUP_RETENTION_DAYS="{{ jenkins_backup_retention_days | default(30) }}"

# Log Configuration
export JENKINS_BG_LOG_LEVEL="${JENKINS_BG_LOG_LEVEL:-info}"
export JENKINS_BG_AUTO_CONFIRM="${JENKINS_BG_AUTO_CONFIRM:-no}"

# File Paths
export JENKINS_BG_STATE_FILE="$JENKINS_HOME/blue-green/state.json"
export JENKINS_BG_LOGS_DIR="$JENKINS_HOME/blue-green/logs"
export JENKINS_BG_SCRIPTS_DIR="$JENKINS_HOME/blue-green/scripts"

# Harbor Registry (if configured)
export HARBOR_REGISTRY_URL="{{ harbor_registry_url | default('') }}"
export HARBOR_PROJECT="{{ harbor_project | default('jenkins') }}"

# Color definitions for scripts
export RED='\033[0;31m'
export GREEN='\033[0;32m'
export YELLOW='\033[1;33m'
export BLUE='\033[0;34m'
export CYAN='\033[0;36m'
export NC='\033[0m'

# Helper functions for scripts
log_info() {
    echo -e "${BLUE}[INFO]${NC} $*"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $*"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $*"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $*"
}

# Export functions for use in scripts
export -f log_info log_success log_warning log_error

echo "Jenkins Blue-Green configuration loaded successfully"