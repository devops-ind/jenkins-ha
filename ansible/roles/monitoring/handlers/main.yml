---
# Handlers for monitoring role
- name: restart monitoring service
  systemd:
    name: monitoring
    state: restarted
    enabled: yes
  listen: "restart monitoring"

- name: reload systemd
  systemd:
    daemon_reload: yes
  listen: "reload systemd"

- name: restart prometheus
  community.docker.docker_container:
    name: prometheus-{{ deployment_environment | default('local') }}
    state: started
    restart: yes
  listen: "restart prometheus"

- name: restart grafana
  community.docker.docker_container:
    name: grafana-{{ deployment_environment | default('local') }}
    state: started
    restart: yes
  listen: "restart grafana"

- name: restart alertmanager
  community.docker.docker_container:
    name: alertmanager-{{ deployment_environment | default('local') }}
    state: started
    restart: yes
  listen: "restart alertmanager"
  when: alertmanager_enabled | default(false)

- name: restart loki
  community.docker.docker_container:
    name: loki-{{ deployment_environment | default('local') }}
    state: started
    restart: yes
  listen: "restart loki"
  when: loki_enabled | default(true)

- name: restart promtail
  community.docker.docker_container:
    name: promtail-{{ deployment_environment | default('local') }}
    state: started
    restart: yes
  listen: "restart promtail"
  when: promtail_enabled | default(true)
