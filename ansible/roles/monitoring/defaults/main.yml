---
# Default variables for monitoring role

# General monitoring configuration
monitoring_enabled: true
monitoring_version: "latest"

# Monitoring user configuration
monitoring_user: "monitoring"
monitoring_group: "monitoring" 
monitoring_uid: 1004
monitoring_gid: 1004
monitoring_home_dir: "{{ '/workspace/monitoring' if deployment_mode | default('local') in ['devcontainer', 'local'] else '/opt/monitoring' }}"

# Network configuration
monitoring_network_name: "monitoring-net"
monitoring_network_subnet: "172.26.0.0/16"

# Service configuration
prometheus_enabled: true
prometheus_port: 9090
prometheus_version: "latest"
prometheus_data_retention: "15d"
prometheus_scrape_interval: "30s"
prometheus_evaluation_interval: "30s"

# Grafana configuration
grafana_enabled: true
grafana_port: 9300  # Changed from 3000 to 9300 for monitoring consistency
grafana_version: "latest"
grafana_admin_user: "admin"
grafana_admin_password: "{{ vault_grafana_admin_password | default('admin123') }}"
grafana_allow_sign_up: false
grafana_disable_gravatar: true
# Dashboard update behavior: always, skip_existing, update_only
dashboard_update_mode: "always"

grafana_prometheus_datasource:
  name: "Prometheus"
  type: "prometheus"
  access: "proxy"
  url: "http://localhost:9090"
  isDefault: true

# Alertmanager configuration
alertmanager_enabled: false
alertmanager_port: 9093
alertmanager_version: "latest"

# Node Exporter configuration
node_exporter_enabled: true
node_exporter_port: 9100
node_exporter_version: "latest"

# Base Prometheus targets configuration
prometheus_base_targets:
  - job: "prometheus"
    targets:
      - "localhost:9090"
  - job: "node-exporter"
    targets:
      - "localhost:9100"

# Dynamic Jenkins targets - generated based on team configuration
# This will be overridden in tasks/main.yml with team-aware targets
prometheus_jenkins_targets: []

# Combined prometheus targets (base + dynamic jenkins)
prometheus_targets: "{{ prometheus_base_targets + prometheus_jenkins_targets }}"

# Docker configuration for monitoring services
monitoring_docker_network: "{{ monitoring_network_name }}"
monitoring_restart_policy: "unless-stopped"

# Additional exporters
cadvisor_enabled: true
cadvisor_port: 9200  # Changed to 9000 range for monitoring consistency

# Directories to create
monitoring_directories:
  - "{{ monitoring_home_dir }}"
  - "{{ monitoring_home_dir }}/prometheus"
  - "{{ monitoring_home_dir }}/prometheus/data"
  - "{{ monitoring_home_dir }}/prometheus/config"
  - "{{ monitoring_home_dir }}/prometheus/rules"
  - "{{ monitoring_home_dir }}/grafana"
  - "{{ monitoring_home_dir }}/grafana/data"
  - "{{ monitoring_home_dir }}/grafana/dashboards"
  - "{{ monitoring_home_dir }}/grafana/provisioning"
  - "{{ monitoring_home_dir }}/grafana/provisioning/dashboards"
  - "{{ monitoring_home_dir }}/grafana/provisioning/datasources"
  - "{{ monitoring_home_dir }}/alertmanager"
  - "{{ monitoring_home_dir }}/exporters"
  - "{{ monitoring_home_dir }}/bin"
  - "{{ monitoring_home_dir }}/logs"
