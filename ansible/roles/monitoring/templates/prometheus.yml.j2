# Prometheus configuration for Jenkins Infrastructure
global:
  scrape_interval: {{ prometheus_scrape_interval }}
  evaluation_interval: {{ prometheus_evaluation_interval }}
  external_labels:
    monitor: 'jenkins-infrastructure'
    environment: '{{ deployment_environment | default("local") }}'

rule_files:
  - "rules/*.yml"

alerting:
{% if alertmanager_enabled | default(false) %}
  alertmanagers:
    - static_configs:
        - targets:
          - localhost:{{ alertmanager_port }}
{% endif %}

scrape_configs:
{% for target in prometheus_targets %}
  - job_name: '{{ target.job }}'
    static_configs:
      - targets: {{ target.targets | to_json }}
{% if target.job == 'jenkins' %}
    metrics_path: /prometheus
{% endif %}
{% endfor %}

{% if node_exporter_enabled | default(true) %}
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:{{ node_exporter_port }}']
{% endif %}

{% if cadvisor_enabled | default(true) %}
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['localhost:8080']
{% endif %}