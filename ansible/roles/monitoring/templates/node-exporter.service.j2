[Unit]
Description=Node Exporter
Documentation=https://prometheus.io/docs/guides/node-exporter/
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User={{ monitoring_user }}
Group={{ monitoring_group }}
ExecStart=/usr/bin/docker run --rm --name node-exporter-{{ deployment_environment | default('local') }} \
  -p {{ node_exporter_port }}:9100 \
  -v /proc:/host/proc:ro \
  -v /sys:/host/sys:ro \
  -v /:/rootfs:ro \
  --network {{ monitoring_docker_network }} \
  prom/node-exporter:{{ node_exporter_version }} \
  --path.procfs=/host/proc \
  --path.rootfs=/rootfs \
  --path.sysfs=/host/sys \
  --collector.filesystem.ignored-mount-points='^/(sys|proc|dev|host|etc)($$|/)'
ExecStop=/usr/bin/docker stop node-exporter-{{ deployment_environment | default('local') }}
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target