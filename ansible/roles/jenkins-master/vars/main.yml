---
# Jenkins Master Role - Internal Variables
# These variables are used internally by the role and should not be overridden

# Internal container states mapping
_jenkins_container_states:
  blue:
    active_when: "{{ jenkins_master_config.active_environment == 'blue' }}"
    state: "{{ 'started' if jenkins_master_config.active_environment == 'blue' else 'stopped' }}"
  green:
    active_when: "{{ jenkins_master_config.active_environment == 'green' }}"
    state: "{{ 'started' if jenkins_master_config.active_environment == 'green' else 'stopped' }}"

# Internal port configurations
_jenkins_port_configs:
  active_ports:
    web: "{{ jenkins_master_config.ports.web }}:{{ jenkins_master_port }}"
    agent: "{{ jenkins_master_config.ports.agent }}:{{ jenkins_jnlp_port }}"
  inactive_ports: []

# Internal volume mappings
_jenkins_volume_mappings:
  home: "{{ jenkins_master_container_home }}"
  shared: "{{ jenkins_master_shared_path }}"
  docker_sock: "/var/run/docker.sock"

# Image name resolution logic
_jenkins_image_resolution:
  custom_image_available: "{{ jenkins_custom_image_registry is defined and jenkins_custom_image_registry | length > 0 }}"
  use_custom_images: "{{ jenkins_master_build_custom_images | default(true) }}"
  fallback_image: "{{ jenkins_master_image_registry }}/{{ jenkins_master_image_name }}:{{ jenkins_master_image_tag }}"

# Container runtime specific configurations
_container_runtime_configs:
  docker:
    module: "community.docker"
    container_module: "docker_container"
    volume_module: "docker_volume"
    network_module: "docker_network"

# Health check configurations
_health_check_configs:
  docker:
    test_format: ["CMD", "curl", "-f", "http://localhost:{{ jenkins_master_port }}/login"]
    interval: "30s"
    timeout: "10s"
    retries: 3
    start_period: "60s"

# Script templates mapping
_script_templates:
  blue_green_switch: "blue-green-switch.sh.j2"
  blue_green_healthcheck: "blue-green-healthcheck.sh.j2"
  blue_green_monitor: "blue-green-monitor.sh.j2"
  health_monitor: "health-monitor.sh.j2"

# Configuration paths
_config_paths:
  haproxy_conf_dir: "/etc/haproxy/conf.d"
  jenkins_scripts_dir: "{{ jenkins_home_dir }}/scripts"
  jenkins_casc_dir: "{{ jenkins_home_dir }}/{{ jenkins_master_config.team_name }}/{{ jenkins_master_config.active_environment }}/casc_configs"

# Internal validation rules
_validation_rules:
  required_fields:
    - "jenkins_master_config.team_name"
    - "jenkins_master_config.active_environment"
    - "jenkins_master_config.ports.web"
    - "jenkins_master_config.ports.agent"
    - "jenkins_master_config.resources.memory"
    - "jenkins_master_config.resources.cpu"
  valid_environments:
    - "blue"
    - "green"
  valid_runtimes:
    - "docker"
  port_range:
    min: 1024
    max: 65535