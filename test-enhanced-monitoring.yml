---
# Test playbook for enhanced monitoring setup
- name: Test Enhanced Monitoring Setup
  hosts: centos9-vm
  become: true
  vars:
    deployment_mode: production
    jenkins_teams:
      - team_name: devops
        active_environment: green
        ports:
          web: 8180
      - team_name: ma
        active_environment: blue
        ports:
          web: 8081
  roles:
    - role: ansible/roles/monitoring
      tags: ['monitoring', 'test']

  post_tasks:
    - name: Display enhanced monitoring deployment summary
      debug:
        msg: |
          ğŸ‰ Enhanced Monitoring Setup Test Completed!
          
          ğŸ“Š Dashboards Deployed:
          â€¢ Jenkins Overview - Production
          â€¢ Jenkins Builds - Production  
          â€¢ Jenkins Dynamic Agents - Production (NEW)
          â€¢ Infrastructure Health - Production
          â€¢ Security Metrics - Production
          
          ğŸ”§ Key Features Tested:
          â€¢ âœ… Deployment mode standardization (using 'production')
          â€¢ âœ… Grafana dashboard update logic (prevent duplication)
          â€¢ âœ… Jenkins URL configuration (prevents placeholder URLs)
          â€¢ âœ… Dynamic agent container labeling
          â€¢ âœ… Multi-team metrics collection
          
          ğŸ“Š Access URLs:
          â€¢ Grafana: http://{{ ansible_default_ipv4.address }}:{{ grafana_port }}
          â€¢ Prometheus: http://{{ ansible_default_ipv4.address }}:{{ prometheus_port }}
          
          ğŸ·ï¸ Container Labels Added:
          â€¢ com.jenkins.agent=true (for agent discovery)
          â€¢ team=[devops|ma|ba|tw] (for team filtering)
          â€¢ agent_type=[maven|python|nodejs|dind] (for type filtering)
          â€¢ deployment_mode={{ deployment_mode }} (for mode awareness)
          â€¢ jenkins_environment=[blue|green] (for blue/green tracking)
      tags: ['test', 'summary']